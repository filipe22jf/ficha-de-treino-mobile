<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Gerador de Fichas de Treino - {{CONSULTOR_NOME}}</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Meta tags para PWA -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="{{CONSULTOR_SHORT_NAME}}">
    <meta name="description" content="Gerador de fichas de treino personalizado para {{CONSULTOR_EMPRESA}}">
    
    <!-- √çcones para iOS -->
    <link rel="apple-touch-icon" href="icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png">
    
    <!-- √çcones para outros navegadores -->
    <link rel="icon" type="image/png" sizes="72x72" href="icon-72x72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icon-96x96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="icon-128x128.png">
    <link rel="icon" type="image/png" sizes="144x144" href="icon-144x144.png">
    <link rel="icon" type="image/png" sizes="152x152" href="icon-152x152.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
    <link rel="icon" type="image/png" sizes="384x384" href="icon-384x384.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 10px;
        font-size: 16px;
        line-height: 1.5;
      }
      
      .container {
        max-width: 100%;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      }
      
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      .logo-template {
        text-align: center;
        margin-bottom: 20px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        color: white;
      }
      
      .logo-template h2 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: bold;
      }
      
      .logo-template p {
        margin: 5px 0 0 0;
        font-size: 1rem;
        opacity: 0.9;
      }
      
      .header h1 {
        color: #333;
        margin: 0;
        font-size: 1.8rem;
      }
      
      .version-badge {
        background: #28a745;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        margin-top: 5px;
        display: inline-block;
      }
      
      .card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e9ecef;
        margin-bottom: 20px;
      }
      
      .card h2 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 1.3rem;
      }
      
      .form-group {
        margin-bottom: 20px;
      }
      
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
        font-size: 14px;
      }
      
      select, input, button {
        width: 100%;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        box-sizing: border-box;
        -webkit-appearance: none;
        appearance: none;
      }
      
      select {
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 20px;
        padding-right: 40px;
      }
      
      input[type="number"] {
        text-align: center;
      }
      
      button {
        background: #667eea;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s;
        font-size: 16px;
        padding: 18px;
        border-radius: 8px;
        margin-top: 10px;
      }
      
      button:hover, button:active {
        background: #5a6fd8;
      }
      
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .exercise-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
        position: relative;
      }
      
      .exercise-item h3 {
        margin: 0 0 8px 0;
        color: #333;
        font-size: 16px;
        padding-right: 40px;
      }
      
      .exercise-item .details {
        color: #666;
        font-size: 14px;
        margin: 5px 0;
        line-height: 1.4;
      }
      
      .exercise-item .technique {
        background: #e3f2fd;
        color: #1976d2;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 12px;
        display: inline-block;
        margin-top: 8px;
        line-height: 1.3;
      }
      
      .remove-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px !important;
        height: 30px !important;
        padding: 0 !important;
        background: #dc3545 !important;
        font-size: 14px !important;
        border-radius: 50% !important;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto;
      }
      
      .empty-state {
        text-align: center;
        color: #999;
        padding: 30px 20px;
      }
      
      .empty-state svg {
        width: 48px;
        height: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }
      
      .counter {
        color: #666;
        margin-bottom: 15px;
        font-size: 14px;
      }
      
      .pdf-section {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }
      
      .pdf-section h3 {
        margin: 0 0 10px 0;
        color: #155724;
        font-size: 16px;
      }
      
      .pdf-section p {
        margin: 0 0 15px 0;
        color: #155724;
        font-size: 14px;
        line-height: 1.4;
      }
      
      .pdf-btn {
        background: #28a745 !important;
        margin-top: 0 !important;
      }
      
      .pdf-btn:hover {
        background: #218838 !important;
      }
      
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
        color: #667eea;
      }
      
      .loading.show {
        display: block;
      }
      
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @media (max-width: 480px) {
        .container {
          padding: 15px;
        }
        
        .form-row {
          grid-template-columns: 1fr;
        }
        
        .header h1 {
          font-size: 1.5rem;
        }
        
        .logo-template h2 {
          font-size: 1.5rem;
        }
      }
    </style>
    
    <!-- PDFMake CDN sem integrity check -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/vfs_fonts.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="logo-template">
        <h2>üèãÔ∏è {{CONSULTOR_NOME_UPPER}}</h2>
        <p>{{CONSULTOR_EMPRESA}}</p>
      </div>
      
      <div class="header">
        <h1>Gerador de Fichas de Treino</h1>
        <p style="color: #666; margin-top: 10px; font-size: 14px;">Vers√£o Mobile Otimizada</p>
        <span class="version-badge">PDFMake - 100% Compat√≠vel</span>
      </div>
      
      <div class="card">
        <h2>üë§ Dados do Aluno</h2>
        <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Preencha as informa√ß√µes do aluno para personalizar a ficha</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="nome-aluno">Nome do Aluno</label>
            <input type="text" id="nome-aluno" placeholder="Digite o nome completo do aluno">
          </div>
          <div class="form-group">
            <label for="data-troca">Data de Troca da Ficha</label>
            <input type="date" id="data-troca">
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2>‚ûï Adicionar Exerc√≠cio</h2>
        <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Configure seu exerc√≠cio com todos os detalhes</p>
        
        <div class="form-group">
          <label for="grupo-muscular">Grupo Muscular</label>
          <select id="grupo-muscular">
            <option value="">Selecione o grupo muscular</option>
            <option value="peitoral">Peitoral</option>
            <option value="dorsais">Dorsais (Costas)</option>
            <option value="ombros">Ombros (Deltoides)</option>
            <option value="bracos">Bra√ßos</option>
            <option value="pernas">Pernas</option>
            <option value="gluteos">Gl√∫teos</option>
            <option value="abdomen">Abd√¥men</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="exercicio">Exerc√≠cio</label>
          <select id="exercicio" disabled>
            <option value="">Primeiro selecione o grupo muscular</option>
          </select>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="series">S√©ries</label>
            <input type="number" id="series" min="1" max="10" value="3">
          </div>
          <div class="form-group">
            <label for="repeticoes">Repeti√ß√µes</label>
            <input type="number" id="repeticoes" min="1" max="50" value="12">
          </div>
        </div>
        
        <div class="form-group">
          <label for="tecnica">T√©cnica (Opcional)</label>
          <select id="tecnica">
            <option value="">Nenhuma t√©cnica</option>
            <option value="Drop set">Drop set</option>
            <option value="Rest-pause">Rest-pause</option>
            <option value="Bi-set">Bi-set</option>
            <option value="Tri-set">Tri-set</option>
            <option value="Giant set">Giant set</option>
            <option value="Super-set">Super-set</option>
            <option value="Pr√©-exaust√£o">Pr√©-exaust√£o</option>
            <option value="P√≥s-exaust√£o">P√≥s-exaust√£o</option>
            <option value="Isometria">Isometria</option>
            <option value="Parciais">Parciais</option>
            <option value="For√ßada">For√ßada</option>
            <option value="Negativa">Negativa</option>
            <option value="Cluster set">Cluster set</option>
            <option value="Piramidal crescente">Piramidal crescente</option>
            <option value="Piramidal decrescente">Piramidal decrescente</option>
            <option value="FST-7">FST-7</option>
          </select>
        </div>
        
        <button onclick="adicionarExercicio()">Adicionar √† Ficha</button>
      </div>
      
      <div class="card">
        <h2>üìã Sua Ficha de Treino</h2>
        <div class="counter">0 exerc√≠cio(s) adicionado(s)</div>
        
        <div id="lista-exercicios">
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <div>
              <strong>Nenhum exerc√≠cio adicionado ainda</strong><br>
              Selecione exerc√≠cios para come√ßar sua ficha
            </div>
          </div>
        </div>
        
        <div id="pdf-section" style="display: none;" class="pdf-section">
          <h3>üì± Gerar PDF Otimizado</h3>
          <p>Esta vers√£o usa PDFMake para m√°xima compatibilidade com dispositivos m√≥veis. O PDF ser√° gerado com texto selecion√°vel e funcionar√° em todos os navegadores.</p>
          
          <button class="pdf-btn" onclick="gerarPDFMake()">
            üìÑ Gerar PDF (PDFMake)
          </button>
          
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Gerando PDF...</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const exerciciosPorGrupo = {
        peitoral: [
          'Supino reto', 'Supino inclinado', 'Supino declinado', 'Supino com pegada fechada',
          'Crucifixo reto', 'Crucifixo inclinado', 'Crucifixo declinado', 'Pullover com halteres',
          'Pullover com barra', 'Flex√£o de bra√ßo tradicional', 'Flex√£o com pegada fechada',
          'Flex√£o diamante', 'Flex√£o arqueiro', 'Flex√£o explosiva/pliom√©trica', 'Peck deck (voador)',
          'Crossover alto, m√©dio e baixo', 'Supino m√°quina (reto, inclinado e declinado)',
          'Press convergente na m√°quina', 'Press no Smith', 'Cable fly (fly no cabo, inclinado ou declinado)'
        ],
        dorsais: [
          'Barra fixa (pronada, supinada, neutra)', 'Pulldown frente', 'Pulldown inverso',
          'Pulldown atr√°s da nuca', 'Pulldown com pegada fechada', 'Pulldown unilateral no cabo',
          'Remada curvada com barra', 'Remada curvada pronada', 'Remada curvada supinada',
          'Remada curvada com pegada mista', 'Remada unilateral com halteres', 'Remada baixa no pulley',
          'Remada cavalinho (T-bar row)', 'Remada no Smith', 'Remada na m√°quina articulada',
          'Remada serratus (focando serr√°til)', 'Pullover no cabo', 'Pullover com halteres',
          'Levantamento terra tradicional', 'Terra romeno', 'Terra sum√¥', 'Good morning',
          'Meadows row (remada unilateral na barra T)'
        ],
        ombros: [
          'Desenvolvimento militar', 'Desenvolvimento Arnold', 'Eleva√ß√£o frontal barra/halteres/cabo',
          'Landmine press', 'Eleva√ß√£o lateral com halteres', 'Eleva√ß√£o lateral no cabo',
          'Eleva√ß√£o lateral sentado', 'Eleva√ß√£o lateral parcial (ponto m√©dio)',
          'Crucifixo inverso com halteres', 'Crucifixo inverso no cabo', 'Crucifixo inverso na m√°quina',
          'Face pull', 'Clean & press', 'Push press', 'Remada alta (barra, cabo, halteres)'
        ],
        bracos: [
          'Rosca direta (barra reta, barra W, halteres)', 'Rosca alternada', 'Rosca martelo',
          'Rosca concentrada', 'Rosca Scott (barra ou halteres)', 'Rosca no cabo baixo',
          'Rosca 21', 'Rosca spider', 'Rosca inversa', 'Tr√≠ceps testa', 'Tr√≠ceps franc√™s',
          'Tr√≠ceps corda', 'Tr√≠ceps barra reta', 'Tr√≠ceps coice', 'Tr√≠ceps banco (mergulho)',
          'Paralelas (dips)', 'Tr√≠ceps invertido no cabo', 'JM press', 'Flex√£o de punho pronada',
          'Flex√£o de punho supinada', 'Farmer\'s walk', 'Prona√ß√£o e supina√ß√£o com halter', 'Wrist roller'
        ],
        pernas: [
          'Agachamento livre', 'Agachamento frontal', 'Hack squat', 'Leg press 45¬∞',
          'Cadeira extensora', 'Passada', 'Afundo', 'Afundo b√∫lgaro', 'Stiff', 'Stiff romeno',
          'Mesa flexora', 'Flexora sentado', 'Nordic curl', 'Adutora no banco/m√°quina',
          'Abdu√ß√£o no cabo/m√°quina', 'Eleva√ß√£o lateral de perna com caneleira'
        ],
        gluteos: [
          'Hip thrust', 'Glute bridge', 'Glute bridge unilateral', 'Kickback no cabo',
          'Step-up no banco', 'Abdu√ß√£o no cabo', 'Abdu√ß√£o na m√°quina', 'Peso morto sum√¥'
        ],
        abdomen: [
          'Abdominal tradicional', 'Abdominal supra/inferior', 'Eleva√ß√£o de pernas',
          'Eleva√ß√£o de joelhos', 'Prancha', 'Prancha lateral', 'Prancha com eleva√ß√£o alternada',
          'Abdominal no cabo', 'Abdominal na bola su√≠√ßa', 'Ab wheel rollout'
        ]
      };

      const tecnicasDescricoes = {
        'Drop set': 'Reduz a carga ap√≥s a falha e continua o exerc√≠cio',
        'Rest-pause': 'Pausas curtas (10‚Äì15 seg) e mais repeti√ß√µes at√© falhar',
        'Bi-set': 'Dois exerc√≠cios para o mesmo m√∫sculo, sem descanso',
        'Tri-set': 'Tr√™s exerc√≠cios para o mesmo m√∫sculo, sem descanso',
        'Giant set': 'Quatro ou mais exerc√≠cios para o mesmo m√∫sculo',
        'Super-set': 'Dois exerc√≠cios de m√∫sculos antagonistas sem descanso',
        'Pr√©-exaust√£o': 'Exerc√≠cio isolado antes do composto',
        'P√≥s-exaust√£o': 'Exerc√≠cio composto antes do isolado',
        'Isometria': 'Segurar o peso em um ponto fixo por tempo',
        'Parciais': 'Movimentos incompletos para prolongar est√≠mulo',
        'For√ßada': 'Parceiro auxilia ap√≥s a falha',
        'Negativa': '√änfase na fase exc√™ntrica',
        'Cluster set': 'Intervalos curtos entre pequenas s√©ries dentro da mesma s√©rie',
        'Piramidal crescente': 'Aumenta a carga e diminui repeti√ß√µes',
        'Piramidal decrescente': 'Diminui carga e aumenta repeti√ß√µes',
        'FST-7': '7 s√©ries de um mesmo exerc√≠cio com pouco descanso (30‚Äì45 seg)'
      };

      let fichaExercicios = [];

      // Atualizar exerc√≠cios quando grupo muscular mudar
      document.getElementById('grupo-muscular').addEventListener('change', function() {
        const grupoSelecionado = this.value;
        const selectExercicio = document.getElementById('exercicio');
        
        selectExercicio.innerHTML = '<option value="">Selecione o exerc√≠cio</option>';
        
        if (grupoSelecionado && exerciciosPorGrupo[grupoSelecionado]) {
          selectExercicio.disabled = false;
          exerciciosPorGrupo[grupoSelecionado].forEach(exercicio => {
            const option = document.createElement('option');
            option.value = exercicio;
            option.textContent = exercicio;
            selectExercicio.appendChild(option);
          });
        } else {
          selectExercicio.disabled = true;
        }
      });

      function adicionarExercicio() {
        const grupo = document.getElementById('grupo-muscular').value;
        const exercicio = document.getElementById('exercicio').value;
        const series = document.getElementById('series').value;
        const repeticoes = document.getElementById('repeticoes').value;
        const tecnica = document.getElementById('tecnica').value;

        if (!grupo || !exercicio || !series || !repeticoes) {
          alert('Por favor, preencha todos os campos obrigat√≥rios.');
          return;
        }

        const novoExercicio = {
          grupo,
          exercicio,
          series: parseInt(series),
          repeticoes: parseInt(repeticoes),
          tecnica
        };

        fichaExercicios.push(novoExercicio);
        atualizarListaExercicios();
        limparFormulario();
      }

      function atualizarListaExercicios() {
        const listaContainer = document.getElementById('lista-exercicios');
        const counter = document.querySelector('.counter');
        const pdfSection = document.getElementById('pdf-section');
        
        counter.textContent = `${fichaExercicios.length} exerc√≠cio(s) adicionado(s)`;

        if (fichaExercicios.length === 0) {
          listaContainer.innerHTML = `
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <div>
                <strong>Nenhum exerc√≠cio adicionado ainda</strong><br>
                Selecione exerc√≠cios para come√ßar sua ficha
              </div>
            </div>
          `;
          pdfSection.style.display = 'none';
        } else {
          let html = '';
          fichaExercicios.forEach((item, index) => {
            html += `
              <div class="exercise-item">
                <button class="remove-btn" onclick="removerExercicio(${index})">√ó</button>
                <h3>${index + 1}. ${item.exercicio}</h3>
                <div class="details">
                  <strong>Grupo:</strong> ${item.grupo.charAt(0).toUpperCase() + item.grupo.slice(1)}<br>
                  <strong>S√©ries:</strong> ${item.series} | <strong>Repeti√ß√µes:</strong> ${item.repeticoes}
                </div>
                ${item.tecnica ? `
                  <div class="technique">
                    <strong>T√©cnica:</strong> ${item.tecnica}
                    ${tecnicasDescricoes[item.tecnica] ? `<br><em>${tecnicasDescricoes[item.tecnica]}</em>` : ''}
                  </div>
                ` : ''}
              </div>
            `;
          });
          listaContainer.innerHTML = html;
          pdfSection.style.display = 'block';
        }
      }

      function removerExercicio(index) {
        fichaExercicios.splice(index, 1);
        atualizarListaExercicios();
      }

      function limparFormulario() {
        document.getElementById('grupo-muscular').value = '';
        document.getElementById('exercicio').value = '';
        document.getElementById('exercicio').disabled = true;
        document.getElementById('exercicio').innerHTML = '<option value="">Primeiro selecione o grupo muscular</option>';
        document.getElementById('series').value = '3';
        document.getElementById('repeticoes').value = '12';
        document.getElementById('tecnica').value = '';
      }

      function mostrarLoading() {
        document.getElementById('loading').classList.add('show');
      }

      function esconderLoading() {
        document.getElementById('loading').classList.remove('show');
      }

      function gerarPDFMake() {
        if (fichaExercicios.length === 0) {
          alert('Adicione pelo menos um exerc√≠cio antes de gerar o PDF.');
          return;
        }

        // Obter dados do aluno
        const nomeAluno = document.getElementById('nome-aluno').value.trim();
        const datatroca = document.getElementById('data-troca').value;

        if (!nomeAluno) {
          alert('Por favor, preencha o nome do aluno antes de gerar o PDF.');
          return;
        }

        mostrarLoading();

        try {
          // Verificar se pdfMake est√° dispon√≠vel
          if (typeof pdfMake === 'undefined') {
            throw new Error('PDFMake n√£o foi carregado corretamente');
          }

          // Formatar data de troca
          let datatrocaFormatada = '';
          if (datatroca) {
            const data = new Date(datatroca + 'T00:00:00');
            datatrocaFormatada = data.toLocaleDateString('pt-BR');
          }

          // Criar estrutura do documento para PDFMake
          const docDefinition = {
            pageSize: 'A4',
            pageMargins: [40, 60, 40, 60],
            content: [
              // Cabe√ßalho
              {
                text: 'üèãÔ∏è {{CONSULTOR_NOME_UPPER}}',
                style: 'header',
                alignment: 'center',
                margin: [0, 0, 0, 5]
              },
              {
                text: '{{CONSULTOR_EMPRESA}}',
                style: 'subheader',
                alignment: 'center',
                margin: [0, 0, 0, 10]
              },
              {
                text: 'CREF: {{CONSULTOR_CREF}}',
                style: 'cref',
                alignment: 'center',
                margin: [0, 0, 0, 10]
              },
              {
                text: 'Contato: {{CONSULTOR_TELEFONE}}',
                style: 'contact',
                alignment: 'center',
                margin: [0, 0, 0, 30]
              },
              
              // T√≠tulo da ficha
              {
                text: 'FICHA DE TREINO',
                style: 'title',
                alignment: 'center',
                margin: [0, 0, 0, 20]
              },
              
              // Dados do aluno
              {
                text: `Aluno: ${nomeAluno}`,
                style: 'studentName',
                alignment: 'left',
                margin: [0, 0, 0, 10]
              },
              
              // Informa√ß√µes da ficha
              {
                columns: [
                  {
                    text: `Data de cria√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`,
                    style: 'info'
                  },
                  {
                    text: datatrocaFormatada ? `Pr√≥xima troca: ${datatrocaFormatada}` : '',
                    style: 'info',
                    alignment: 'right'
                  }
                ],
                margin: [0, 0, 0, 10]
              },
              
              {
                text: `Total de exerc√≠cios: ${fichaExercicios.length}`,
                style: 'info',
                alignment: 'center',
                margin: [0, 0, 0, 30]
              },
              
              // Lista de exerc√≠cios
              ...fichaExercicios.map((exercicio, index) => {
                const exercicioContent = [
                  {
                    text: `${index + 1}. ${exercicio.exercicio}`,
                    style: 'exerciseTitle',
                    margin: [0, 0, 0, 5]
                  },
                  {
                    columns: [
                      {
                        text: `Grupo: ${exercicio.grupo.charAt(0).toUpperCase() + exercicio.grupo.slice(1)}`,
                        style: 'exerciseDetail'
                      },
                      {
                        text: `S√©ries: ${exercicio.series}`,
                        style: 'exerciseDetail'
                      },
                      {
                        text: `Repeti√ß√µes: ${exercicio.repeticoes}`,
                        style: 'exerciseDetail'
                      }
                    ],
                    margin: [0, 0, 0, 5]
                  }
                ];

                // Adicionar t√©cnica se existir
                if (exercicio.tecnica) {
                  exercicioContent.push({
                    text: [
                      { text: 'T√©cnica: ', style: 'techniqueLabel' },
                      { text: exercicio.tecnica, style: 'techniqueValue' }
                    ],
                    margin: [0, 0, 0, 5]
                  });

                  if (tecnicasDescricoes[exercicio.tecnica]) {
                    exercicioContent.push({
                      text: tecnicasDescricoes[exercicio.tecnica],
                      style: 'techniqueDescription',
                      margin: [0, 0, 0, 5]
                    });
                  }
                }

                return {
                  stack: exercicioContent,
                  margin: [0, 0, 0, 20],
                  border: [false, false, false, true],
                  borderColor: '#667eea',
                  borderWidth: [0, 0, 0, 2]
                };
              }),
              
              // Rodap√©
              {
                text: 'Ficha gerada pelo sistema de {{CONSULTOR_NOME}} - {{CONSULTOR_EMPRESA}}\nVers√£o Mobile Otimizada com PDFMake',
                style: 'footer',
                alignment: 'center',
                margin: [0, 30, 0, 0]
              }
            ],
            
            styles: {
              header: {
                fontSize: 24,
                bold: true,
                color: '#667eea'
              },
              subheader: {
                fontSize: 14,
                color: '#667eea'
              },
              cref: {
                fontSize: 12,
                color: '#667eea',
                bold: true
              },
              contact: {
                fontSize: 12,
                color: '#667eea'
              },
              title: {
                fontSize: 20,
                bold: true,
                color: '#333'
              },
              studentName: {
                fontSize: 16,
                bold: true,
                color: '#333'
              },
              info: {
                fontSize: 12,
                color: '#666'
              },
              exerciseTitle: {
                fontSize: 16,
                bold: true,
                color: '#333'
              },
              exerciseDetail: {
                fontSize: 12,
                color: '#666'
              },
              techniqueLabel: {
                fontSize: 12,
                bold: true,
                color: '#1976d2'
              },
              techniqueValue: {
                fontSize: 12,
                color: '#1976d2'
              },
              techniqueDescription: {
                fontSize: 10,
                italics: true,
                color: '#1976d2'
              },
              footer: {
                fontSize: 10,
                color: '#999'
              }
            }
          };

          // Gerar e baixar o PDF
          const nomeArquivo = nomeAluno.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
          const fileName = `ficha-treino-${nomeArquivo}-${new Date().toLocaleDateString("pt-BR").replace(/\//g, '-')}.pdf`;
          
          pdfMake.createPdf(docDefinition).download(fileName);
          
          esconderLoading();
          
        } catch (error) {
          console.error("Erro ao gerar PDF com PDFMake:", error);
          esconderLoading();
          alert("Erro ao gerar PDF: " + error.message);
        }
      }
    </script>
    
    <!-- Registro do Service Worker para PWA -->
    <script>
      // Registrar o service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('service-worker.js')
            .then(function(registration) {
              console.log('Service Worker registrado com sucesso:', registration.scope);
            })
            .catch(function(error) {
              console.log('Falha ao registrar Service Worker:', error);
            });
        });
      }

      // Detectar se o PWA foi instalado
      let deferredPrompt;
      
      window.addEventListener('beforeinstallprompt', (e) => {
        // Previne o prompt autom√°tico do Chrome
        e.preventDefault();
        // Salva o evento para que possamos disparar depois
        deferredPrompt = e;
        
        // Mostra um banner ou bot√£o personalizado para instalar o PWA
        console.log('PWA pode ser instalado');
        
        // Opcional: Mostrar um bot√£o de instala√ß√£o personalizado
        showInstallButton();
      });

      function showInstallButton() {
        // Criar um bot√£o de instala√ß√£o se n√£o existir
        if (!document.getElementById('install-button')) {
          const installButton = document.createElement('button');
          installButton.id = 'install-button';
          installButton.textContent = 'üì± Instalar App';
          installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
          `;
          
          installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
              // Mostra o prompt de instala√ß√£o
              deferredPrompt.prompt();
              // Aguarda a escolha do usu√°rio
              const { outcome } = await deferredPrompt.userChoice;
              console.log(`Usu√°rio ${outcome} a instala√ß√£o`);
              // Limpa o prompt salvo
              deferredPrompt = null;
              // Remove o bot√£o
              installButton.remove();
            }
          });
          
          document.body.appendChild(installButton);
        }
      }

      // Detectar quando o PWA foi instalado
      window.addEventListener('appinstalled', (evt) => {
        console.log('PWA foi instalado');
        // Remove o bot√£o de instala√ß√£o se existir
        const installButton = document.getElementById('install-button');
        if (installButton) {
          installButton.remove();
        }
      });
    </script>
  </body>
</html>

